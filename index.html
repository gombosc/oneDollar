<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dollar War</title>
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. React libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- 3. Babel to compile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* A simple animation for the welcome modal, since it's not in Tailwind */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-900">
    <!-- This is where our React app will be rendered -->
    <div id="root"></div>

    <!-- 4. Your React code, with type="text/babel" to tell Babel to translate it -->
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- MOCK DATA ---
        const initialClans = [
          { id: 'c1', name: 'StreamerSquad', team: 'RED', memberCount: 152, motto: 'For the Content!' },
          { id: 'c2', name: 'The Blue Crew', team: 'BLUE', memberCount: 131, motto: 'Ride the Wave.' },
          { id: 'c3', name: 'Red Dragons', team: 'RED', memberCount: 98, motto: 'Feel the Burn.' },
          { id: 'c4', name: 'Oceanic Gamers', team: 'BLUE', memberCount: 76, motto: 'Deeper Than the Rest.' },
        ];

        const initialDonations = Array.from({ length: 50 }, (_, i) => ({
          id: `d${i}`,
          userId: `u${i}`,
          userName: `User${Math.floor(Math.random() * 1000)}`,
          team: Math.random() > 0.5 ? 'RED' : 'BLUE',
          clan: initialClans[Math.floor(Math.random() * initialClans.length)].name,
          amount: Math.random() > 0.1 ? 1 : Math.floor(Math.random() * 50) + 5,
          timestamp: Date.now() - Math.random() * 1000 * 60 * 60 * 24,
        }));

        // --- CONSEQUENCE POOL ---
        const FAME_CONSEQUENCES = [
          { type: 'Fame', title: 'Golden Touch!', description: 'Your next $1 donation counts as $5 for your team!' },
          { type: 'Fame', title: 'Spotlight!', description: 'Your name is featured on the Wall of Fame for the next hour.' },
          { type: 'Fame', title: 'The Crown!', description: 'You\'ve earned a permanent "Daredevil" badge on the leaderboard.' },
        ];

        const SHAME_CONSEQUENCES = [
          { type: 'Shame', title: 'Soggy Sock!', description: 'You\'ve been awarded an embarrassing badge. Better luck next time!' },
          { type: 'Shame', title: 'Jumpscare!', description: 'A rubber chicken screams in the distance. You flinched.' },
          { type: 'Shame', 'title': 'Rickrolled!', description: 'You know the rules, and so do I. Your dollar is never gonna give you up.' },
        ];


        // --- HELPER COMPONENTS ---

        const WelcomeModal = ({ onContinue }) => {
            return (
                <div className="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center z-50 p-4">
                    <div className="bg-gray-800 rounded-lg shadow-2xl p-8 w-full max-w-xl text-white border-2 border-yellow-500 text-center transform transition-all animate-fade-in-up">
                        <h1 className="text-4xl font-extrabold mb-4 text-yellow-400">Welcome to Dollar War!</h1>
                        <div className="text-lg text-gray-300 space-y-4 my-6">
                            <p>The rules are simple. Donate <strong className="text-white">one dollar</strong> to see the name of the person who donated right before you.</p>
                            <p>Your donation enters you into a 50/50 draw for <strong className="text-green-400">Fame</strong> (a cool reward) or <strong className="text-purple-400">Shame</strong> (a funny punishment).</p>
                            <p>Every dollar fuels the war. Join <strong className="text-red-500">Team Red</strong> or <strong className="text-blue-500">Team Blue</strong> and fight for victory before the clock hits zero!</p>
                        </div>
                        <button
                            onClick={onContinue}
                            className="w-full max-w-xs mx-auto bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-3 rounded-lg text-xl transition-transform transform hover:scale-105"
                        >
                            I'm Ready
                        </button>
                    </div>
                </div>
            );
        };

        const CountdownTimer = () => {
          const calculateTimeLeft = () => {
            const difference = +new Date("2026-01-01T00:00:00") - +new Date();
            let timeLeft = {};

            if (difference > 0) {
              timeLeft = {
                days: Math.floor(difference / (1000 * 60 * 60 * 24)),
                hours: Math.floor((difference / (1000 * 60 * 60)) % 24),
                minutes: Math.floor((difference / 1000 / 60) % 60),
                seconds: Math.floor((difference / 1000) % 60),
              };
            }
            return timeLeft;
          };

          const [timeLeft, setTimeLeft] = useState(calculateTimeLeft());

          useEffect(() => {
            const timer = setTimeout(() => {
              setTimeLeft(calculateTimeLeft());
            }, 1000);
            return () => clearTimeout(timer);
          });

          const timerComponents = Object.entries(timeLeft).map(([interval, value]) => (
            <div key={interval} className="flex flex-col items-center mx-2 sm:mx-4">
              <span className="text-2xl sm:text-4xl font-bold text-white">{String(value).padStart(2, '0')}</span>
              <span className="text-xs sm:text-sm uppercase text-gray-300">{interval}</span>
            </div>
          ));

          return (
            <div className="flex justify-center">{timerComponents.length ? timerComponents : <span>Time's up!</span>}</div>
          );
        };

        const OnboardingModal = ({ onComplete, clans }) => {
          const [name, setName] = useState('');
          const [team, setTeam] = useState(null);
          const [path, setPath] = useState(null);
          const [selectedClan, setSelectedClan] = useState('');
          const [newClanName, setNewClanName] = useState('');

          const isReady = () => {
            if (!name.trim() || !team || !path) return false;
            if (path === 'JOIN' && !selectedClan) return false;
            if (path === 'CREATE' && !newClanName.trim()) return false;
            return true;
          };

          const handleSubmit = () => {
            if (!isReady()) return;

            let userClan;
            let newClan;

            if (path === 'JOIN') {
              userClan = selectedClan;
            } else if (path === 'CREATE') {
              userClan = newClanName.trim();
              newClan = {
                id: `c${Date.now()}`,
                name: newClanName.trim(),
                team: team,
                memberCount: 1,
                motto: "A Clan of Dares"
              };
            }

            onComplete({ id: `u${Date.now()}`, name: name.trim(), team, clan: userClan }, newClan);
          };

          return (
            <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
              <div className="bg-gray-800 rounded-lg shadow-2xl p-8 w-full max-w-lg text-white border border-gray-700">
                <h2 className="text-3xl font-bold mb-2 text-center">Join the Dare!</h2>
                <p className="text-gray-400 mb-6 text-center">Create your identity for the event.</p>
                
                <div className="grid grid-cols-1 gap-6 mb-6">
                  <div>
                    <label htmlFor="name" className="block text-sm font-medium text-gray-300 mb-1">1. Choose Username</label>
                    <input
                      id="name"
                      type="text"
                      value={name}
                      onChange={(e) => setName(e.target.value)}
                      placeholder="LegendaryDaredevil"
                      className="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500"
                    />
                  </div>
                  <div>
                    <p className="block text-sm font-medium text-gray-300 mb-1">2. Join the World War</p>
                    <div className="flex gap-2">
                      <button
                        onClick={() => setTeam('RED')}
                        className={`w-1/2 py-2 rounded-md text-lg font-bold transition-all duration-200 ${team === 'RED' ? 'bg-red-600 ring-2 ring-white' : 'bg-red-800 hover:bg-red-700'}`}
                      >
                        TEAM RED
                      </button>
                      <button
                        onClick={() => setTeam('BLUE')}
                        className={`w-1/2 py-2 rounded-md text-lg font-bold transition-all duration-200 ${team === 'BLUE' ? 'bg-blue-600 ring-2 ring-white' : 'bg-blue-800 hover:bg-blue-700'}`}
                      >
                        TEAM BLUE
                      </button>
                    </div>
                  </div>
                </div>

                <div className="mb-6">
                  <p className="block text-sm font-medium text-gray-300 mb-2">3. Choose Your Path</p>
                  <div className="grid grid-cols-3 gap-2">
                    <button onClick={() => setPath('SOLO')} className={`p-3 rounded-md font-semibold transition-all ${path === 'SOLO' ? 'bg-green-600 ring-2 ring-white' : 'bg-gray-700 hover:bg-gray-600'}`}>Go Solo</button>
                    <button onClick={() => setPath('JOIN')} className={`p-3 rounded-md font-semibold transition-all ${path === 'JOIN' ? 'bg-green-600 ring-2 ring-white' : 'bg-gray-700 hover:bg-gray-600'}`}>Join Clan</button>
                    <button onClick={() => setPath('CREATE')} className={`p-3 rounded-md font-semibold transition-all ${path === 'CREATE' ? 'bg-green-600 ring-2 ring-white' : 'bg-gray-700 hover:bg-gray-600'}`}>Create Clan</button>
                  </div>
                </div>

                {path === 'JOIN' && team && (
                  <div className="mb-4">
                    <label htmlFor="join-clan" className="block text-sm font-medium text-gray-300 mb-1">Select a Clan</label>
                    <select
                      id="join-clan"
                      value={selectedClan}
                      onChange={(e) => setSelectedClan(e.target.value)}
                      className="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-green-500"
                    >
                      <option value="" disabled>-- Select a Clan --</option>
                      {clans.filter(c => c.team === team).map(c => <option key={c.id} value={c.name}>{c.name} ({c.memberCount})</option>)}
                    </select>
                  </div>
                )}

                {path === 'CREATE' && (
                  <div className="mb-4">
                    <label htmlFor="create-clan" className="block text-sm font-medium text-gray-300 mb-1">New Clan Name</label>
                    <input
                      id="create-clan"
                      type="text"
                      value={newClanName}
                      onChange={(e) => setNewClanName(e.target.value)}
                      placeholder="e.g., The Daredevils"
                      className="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500"
                    />
                  </div>
                )}
                
                <button
                  onClick={handleSubmit}
                  disabled={!isReady()}
                  className="w-full bg-yellow-500 hover:bg-yellow-400 disabled:bg-gray-600 disabled:cursor-not-allowed text-gray-900 font-bold py-3 rounded-lg text-lg transition-all duration-200"
                >
                  Enter the Arena
                </button>
              </div>
            </div>
          );
        };

        const DareModal = ({ onDare, onCancel }) => {
          return (
            <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4">
              <div className="bg-gray-800 rounded-lg shadow-2xl p-8 w-full max-w-md text-white border border-gray-700 text-center">
                <h2 className="text-3xl font-bold mb-2">The Moment of Truth</h2>
                <p className="text-gray-400 mb-6">Donate $1 to see who donated before you and receive your consequence.</p>
                <div className="bg-gray-900 p-4 rounded-lg mb-6">
                    <p className="text-sm text-gray-400">The user before you was...</p>
                    <p className="text-2xl font-bold text-yellow-400 animate-pulse">???</p>
                </div>
                <div className="flex flex-col gap-4">
                    <button
                        onClick={onDare}
                        className="w-full bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-4 rounded-lg text-xl transition-transform transform hover:scale-105"
                    >
                        DARE FOR $1
                    </button>
                    <button
                        onClick={onCancel}
                        className="text-gray-400 hover:text-white"
                    >
                        Maybe later...
                    </button>
                </div>
              </div>
            </div>
          );
        };

        const ConsequenceModal = ({ consequence, lastDonator, onClose }) => {
            const isFame = consequence.type === 'Fame';
            return (
                <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
                    <div className={`bg-gray-900 rounded-lg shadow-2xl p-8 w-full max-w-lg text-white border-2 ${isFame ? 'border-yellow-400' : 'border-purple-500'} text-center`}>
                        <div className="mb-4">
                            <p className="text-lg text-gray-400">The user before you was:</p>
                            <p className="text-4xl font-bold text-white">{lastDonator}</p>
                        </div>
                        <div className={`my-6 p-4 rounded-lg ${isFame ? 'bg-yellow-500/20' : 'bg-purple-500/20'}`}>
                            <h2 className={`text-5xl font-extrabold ${isFame ? 'text-yellow-400' : 'text-purple-400'}`}>{consequence.title}</h2>
                            <p className="text-lg text-gray-300 mt-2">{consequence.description}</p>
                        </div>
                        <button
                            onClick={onClose}
                            className="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 rounded-lg text-lg transition-all duration-200"
                        >
                            Return to Arena
                        </button>
                    </div>
                </div>
            );
        };


        // --- MAIN APP COMPONENT ---
        const App = () => {
          const [showWelcome, setShowWelcome] = useState(true);
          const [user, setUser] = useState(null);
          const [donations, setDonations] = useState(initialDonations);
          const [clans, setClans] = useState(initialClans);
          
          const [showDareModal, setShowDareModal] = useState(false);
          const [lastConsequence, setLastConsequence] = useState(null);
          const [hasTakenFirstDare, setHasTakenFirstDare] = useState(false);

          const handleOnboardingComplete = (newUser, newClan) => {
            setUser(newUser);
            if (newClan) {
              setClans(prev => [...prev, newClan]);
            }
          };

          const handleTakeDare = () => {
            setShowDareModal(true);
          };

          const handleDonation = () => {
            if (!user) return;

            const newDonation = {
              id: `d${Date.now()}`,
              userId: user.id,
              userName: user.name,
              team: user.team,
              clan: user.clan,
              amount: 1,
              timestamp: Date.now(),
            };
            setDonations(prev => [newDonation, ...prev]);

            const isFame = Math.random() > 0.5;
            const consequence = isFame
              ? FAME_CONSEQUENCES[Math.floor(Math.random() * FAME_CONSEQUENCES.length)]
              : SHAME_CONSEQUENCES[Math.floor(Math.random() * SHAME_CONSEQUENCES.length)];
            
            setLastConsequence(consequence);
            setShowDareModal(false);

            if (!hasTakenFirstDare) {
              setHasTakenFirstDare(true);
            }
          };

          const teamTotals = useMemo(() => {
            return donations.reduce((acc, d) => {
              acc[d.team] = (acc[d.team] || 0) + d.amount;
              return acc;
            }, { RED: 0, BLUE: 0 });
          }, [donations]);
          
          const totalRaised = useMemo(() => teamTotals.RED + teamTotals.BLUE, [teamTotals]);
          const totalCharity = useMemo(() => totalRaised * 0.5, [totalRaised]);

          const topClans = useMemo(() => {
            const clanTotals = {};
            donations.forEach(d => {
                if(d.clan) {
                    clanTotals[d.clan] = clanTotals[d.clan] || { total: 0, team: d.team };
                    clanTotals[d.clan].total += d.amount;
                }
            });
            return Object.entries(clanTotals)
                .sort(([, a], [, b]) => b.total - a.total)
                .slice(0, 5)
                .map(([name, data]) => ({ name, ...data }));
          }, [donations, clans]);

          const topDaredevils = useMemo(() => {
            const userTotals = {};
            donations.forEach(d => {
                userTotals[d.userId] = userTotals[d.userId] || { name: d.userName, total: 0 };
                userTotals[d.userId].total += d.amount;
            });
            return Object.values(userTotals)
                .sort((a, b) => b.total - a.total)
                .slice(0, 5);
          }, [donations]);

          const lastDonator = useMemo(() => donations[0]?.userName || 'The Void', [donations]);

          const renderContent = () => {
            if (showWelcome) {
                return <WelcomeModal onContinue={() => setShowWelcome(false)} />;
            }
            if (!user) {
                return <OnboardingModal onComplete={handleOnboardingComplete} clans={clans} />;
            }
            return null;
          }

          return (
            <React.Fragment>
              {renderContent()}
              {lastConsequence && <ConsequenceModal consequence={lastConsequence} lastDonator={lastDonator} onClose={() => setLastConsequence(null)} />}
              {user && showDareModal && <DareModal onDare={handleDonation} onCancel={() => setShowDareModal(false)} />}

              <header className="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-20 py-4 px-4 sm:px-8 border-b border-gray-700">
                <div className="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between">
                  <div className="text-center sm:text-left mb-4 sm:mb-0">
                    <h1 className="text-2xl sm:text-3xl font-bold">Dollar War</h1>
                    <p className="text-sm text-gray-400">What’s one dollar between you and infamy?</p>
                  </div>
                  <CountdownTimer />
                </div>
              </header>

              <main className="p-4 sm:p-8 max-w-7xl mx-auto">
                
                <div className="text-center my-8">
                    <button onClick={handleTakeDare} disabled={!user} className="bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-4 px-12 rounded-full text-2xl shadow-lg shadow-yellow-500/20 transition-transform transform hover:scale-105 z-10 relative disabled:bg-gray-600 disabled:cursor-not-allowed">
                        TAKE THE DARE
                    </button>
                </div>
                
                <div className="relative">
                    <div className={`transition-all duration-700 ease-in-out ${!hasTakenFirstDare ? 'blur-md pointer-events-none' : 'blur-none'}`}>
                        <div className="relative my-12">
                            <div className="flex items-center justify-between gap-2 sm:gap-4">
                                <div className="flex-1 bg-red-600 p-4 sm:p-6 rounded-l-lg text-left shadow-lg">
                                    <h2 className="text-xl sm:text-3xl font-bold">TEAM RED</h2>
                                    <p className="text-2xl sm:text-4xl font-mono">${teamTotals.RED.toLocaleString()}</p>
                                </div>
                                <div className="flex-1 bg-blue-600 p-4 sm:p-6 rounded-r-lg text-right shadow-lg">
                                    <h2 className="text-xl sm:text-3xl font-bold">TEAM BLUE</h2>
                                    <p className="text-2xl sm:text-4xl font-mono">${teamTotals.BLUE.toLocaleString()}</p>
                                </div>
                            </div>
                            <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gray-800 border-2 border-gray-600 rounded-full w-20 h-20 sm:w-24 sm:h-24 flex items-center justify-center font-bold text-2xl text-yellow-300">VS</div>
                        </div>
                        
                        <div className="text-center my-12 bg-gray-800/50 p-6 rounded-lg border border-gray-700 max-w-2xl mx-auto">
                            <p className="text-lg text-gray-400">Total Raised So Far</p>
                            <p className="text-5xl font-bold font-mono text-green-400 my-2">${totalRaised.toLocaleString()}</p>
                            <p className="text-md text-green-300/80">(${totalCharity.toLocaleString()} going to charity)</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                                <h3 className="text-2xl font-bold mb-4 text-yellow-400">Top Clans</h3>
                                <ul>
                                    {topClans.map((clan, i) => (
                                        <li key={i} className="flex justify-between items-center p-3 rounded-md even:bg-gray-700/50">
                                            <span className="font-semibold text-lg flex items-center">
                                              <span className={`w-3 h-3 rounded-full mr-3 ${clan.team === 'RED' ? 'bg-red-500' : 'bg-blue-500'}`}></span>
                                              {i + 1}. {clan.name}
                                            </span>
                                            <span className="font-mono text-lg text-green-400">${clan.total.toLocaleString()}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                            <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
                                <h3 className="text-2xl font-bold mb-4 text-yellow-400">Top Daredevils</h3>
                                <ul>
                                     {topDaredevils.map((dev, i) => (
                                        <li key={i} className="flex justify-between items-center p-3 rounded-md even:bg-gray-700/50">
                                            <span className="font-semibold text-lg">{i + 1}. {dev.name}</span>
                                            <span className="font-mono text-lg text-green-400">${dev.total.toLocaleString()}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        </div>
                    </div>

                    {!hasTakenFirstDare && (
                        <div className="absolute inset-0 flex items-center justify-center z-10 -mt-16">
                            <div className="text-center bg-gray-900/70 backdrop-blur-sm p-8 rounded-lg border border-gray-700 shadow-2xl">
                                <h3 className="text-2xl font-bold text-yellow-300">The Arena is Hidden</h3>
                                <p className="text-lg text-gray-200 mt-2">Take the Dare to reveal the state of the war!</p>
                            </div>
                        </div>
                    )}
                </div>
              </main>
            </React.Fragment>
          );
        }

        // 5. This line finds the <div id="root"> and tells React to render your app inside it.
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>
